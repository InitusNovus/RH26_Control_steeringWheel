/*
 * Qspi_Mpu9250.c
 *
 *  Created on: 2019. 6. 24.
 *      Author: bigbi_000
 */


/******************************************************************************/
/*----------------------------------Includes----------------------------------*/
/******************************************************************************/
#include "Qspi_Mpu9250.h"
#include "Bsp.h"
/******************************************************************************/
/*-----------------------------------Macros-----------------------------------*/
/******************************************************************************/

/******************************************************************************/
/*--------------------------------Enumerations--------------------------------*/
/******************************************************************************/


/******************************************************************************/
/*-----------------------------Data Structures--------------------------------*/
/******************************************************************************/


/******************************************************************************/
/*------------------------------Global variables------------------------------*/
/******************************************************************************/
IFX_EXTERN Qspi_t g_Qspi;

/******************************************************************************/
/*-------------------------Function Prototypes--------------------------------*/
/******************************************************************************/


/******************************************************************************/
/*------------------------Private Variables/Constants-------------------------*/
/******************************************************************************/


/******************************************************************************/
/*-------------------------Function Implementations---------------------------*/
/******************************************************************************/

void HLD_Qspi_Mpu9250_writeReg(uint8 address, uint8 value)
{
	uint8 tx[2]={address,value};
	while( IfxQspi_SpiMaster_getStatus(&g_Qspi.drivers.spiMasterChannel) == SpiIf_Status_busy );
	// send/receive new stream
	IfxQspi_SpiMaster_exchange(&g_Qspi.drivers.spiMasterChannel, tx, NULL_PTR, 2);
}

uint8 HLD_Qspi_Mpu9250_readReg(uint8 address)
{
	uint8 tx[2]={(0b10000000|address),0x00};

	IfxQspi_SpiMaster_exchange(&g_Qspi.drivers.spiMasterChannel, tx, g_Qspi.rx, 2);

	waitTime(TimeConst_10us*2);
//	while(IfxQspi_getReceiveFifoLevel(g_Qspi.drivers.spiMaster.qspi)<2);
	//	return g_Qspi.rx[0];
	return g_Qspi.rx[1];
}

sint16 HLD_Qspi_Mpu9250_getSint16(uint8 addressLow,uint8 addressHigh)
{
	uint8 lowbyte;
	uint8 highbyte;
	lowbyte=HLD_Qspi_readReg(addressLow);
	highbyte=HLD_Qspi_readReg(addressHigh);
	return (sint16)((uint16)(highbyte<<8)|lowbyte);
}


